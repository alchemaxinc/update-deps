name: 'Update Go Dependencies'

description: 'Update Go module dependencies'

inputs:
  token:
    required: true
    description: 'GitHub token'
    default: ${{ github.token }}

  base-branch:
    required: true
    description: 'Base branch for PR'
    default: 'develop'

  branch-prefix:
    required: true
    description: 'Branch prefix'
    default: 'update-dependencies'

runs:
  using: 'composite'
  steps:
    - name: Checkout and setup
      uses: alchemaxinc/composite-toolbox/checkout-and-setup@v1
      with:
        token: ${{ inputs.token }}

    - name: Setup Go
      uses: actions/setup-go@v5
      with:
        go-version-file: 'go.mod'
        cache: true
        cache-dependency-path: '**/go.sum'

    - name: Update dependencies
      shell: bash
      run: |
        go get -t -u ./...
        go mod tidy

    - name: Check for changes
      id: check_changes
      uses: alchemaxinc/composite-toolbox/check-changes@v1
      with:
        files: 'go.mod go.sum'

    - name: Create Pull Request
      if: steps.check_changes.outputs.has_changes == 'true'
      uses: alchemaxinc/composite-toolbox/create-pr@v1
      with:
        token: ${{ inputs.token }}
        base-branch: ${{ inputs.base-branch }}
        branch-prefix: ${{ inputs.branch-prefix }}
        files: 'go.mod go.sum'
        commit-message: 'Update Go dependencies'
        pr-title: 'Update Go dependencies'
        pr-body: |
          # :arrows_counterclockwise: Go Module Dependencies Update

          This pull request automatically updates Go module dependencies to their latest versions.

          ## :warning: Important Notes

          - :robot: This PR was **automatically generated**
          - :mag: Please **review all changes** carefully before merging
          - :test_tube: Ensure all tests pass and functionality works as expected
          - :books: Check for any breaking changes or release notes for updated modules

          ## :rocket: Next Steps

          1. Review the dependency changes above
          2. Run tests locally or wait for CI/CD to complete
          3. Merge when everything looks good!

          ---

          *Generated by the Go Dependencies Update action* :sparkles:
