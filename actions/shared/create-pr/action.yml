name: 'Create Pull Request'
description: 'Create PR with dependency updates'
inputs:
  token:
    description: 'GitHub token'
    required: true
  base-branch:
    description: 'Base branch for PR'
    required: true
    default: 'develop'
  branch-prefix:
    description: 'Prefix for new branch'
    required: true
    default: 'update-dependencies'
  files:
    description: 'Files to commit'
    required: true
  language:
    description: 'Programming language (for PR body)'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Create and push branch
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.token }}
      run: |
        BRANCH_NAME="${{ inputs.branch-prefix }}-$(date +%Y%m%d)-${{ github.run_id }}"
        git checkout -b "$BRANCH_NAME"
        git add ${{ inputs.files }}
        git commit -m "chore: update dependencies

        This PR was automatically generated by the update-deps workflow."
        git push --force origin "$BRANCH_NAME"
        
        # Set branch name for next step
        echo "BRANCH_NAME=$BRANCH_NAME" >> $GITHUB_ENV

    - name: Create Pull Request
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.token }}
      run: |
        gh pr create \
          --title "chore: update dependencies" \
          --body "This PR updates ${{ inputs.language }} dependencies to their latest versions.

        **Changes:**
        - Updated dependency files with new versions

        This PR was automatically generated by the \`update-deps\` workflow.

        Please review the changes and test thoroughly before merging." \
          --head "$BRANCH_NAME" \
          --base "${{ inputs.base-branch }}"
